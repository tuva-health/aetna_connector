version: 2

models:
### final
# Claims input
  - name: eligibility
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - person_id
            - enrollment_start_date
            - enrollment_end_date
            - "{{ '\"plan\"' if (target.type == 'fabric') else 'plan' }}"
            - payer
            - data_source
          tags: ['tuva_dqi_sev_1', 'dqi']

  - name: medical_claim
    tests: 
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - claim_id
            - claim_line_number
            - data_source
          tags: ['tuva_dqi_sev_1', 'dqi']

### intermediate
  - name: int_eligibility
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - person_id
            - enrollment_start_date
            - enrollment_end_date
            - "{{ '\"plan\"' if (target.type == 'fabric') else 'plan' }}"
            - payer
            - data_source
          tags: ['tuva_dqi_sev_1', 'dqi']

  - name: int_medical_claim_adr

  - name: int_medical_claim_deduped
    tests: 
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - claim_id
            - claim_line_number
            - data_source
          tags: ['tuva_dqi_sev_1', 'dqi']
